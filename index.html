<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#991b1b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Sistema Vida - Alimento Di√°rio</title>
    
    <!-- Bibliotecas -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- Fontes -->
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&family=Press+Start+2P&family=Inter:wght@400;600;700&family=Poppins:wght@300;400;600;800&family=Lora:ital,wght@0,400;1,400&family=Dancing+Script:wght@600&family=Montserrat:wght@400;700&family=Bebas+Neue&family=Permanent+Marker&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- ESTILOS GERAIS --- */
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .font-serif { font-family: 'Merriweather', serif; }
        .font-handwriting { font-family: 'Courier New', Courier, monospace; }
        .font-arcade { font-family: 'Press Start 2P', cursive; }
        .font-inter { font-family: 'Inter', sans-serif; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.5s ease-out forwards; }
        
        @keyframes bounce-subtle { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        .animate-bounce-subtle { animation: bounce-subtle 2s infinite ease-in-out; }
        
        /* Anima√ß√£o das barras de √°udio */
        @keyframes sound-bar { 0% { height: 10%; } 50% { height: 100%; } 100% { height: 10%; } }
        .sound-bar { width: 6px; background-color: #FCD34D; border-radius: 99px; animation: sound-bar 0.8s infinite ease-in-out; }
        .sound-bar:nth-child(1) { animation-delay: 0.1s; } .sound-bar:nth-child(2) { animation-delay: 0.3s; } .sound-bar:nth-child(3) { animation-delay: 0.5s; }

        /* Jogo da Mem√≥ria */
        .memory-card { perspective: 1000px; cursor: pointer; }
        .memory-card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; border-radius: 0.5rem; }
        .memory-card.is-flipped .memory-card-inner { transform: rotateY(180deg); }
        .memory-card-front, .memory-card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 0.5rem; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .memory-card-back { background-color: #3B82F6; color: white; font-size: 1.5rem; transform: rotateY(0deg); }
        .memory-card-front { background-color: #E5E7EB; color: #1F2937; font-size: 2rem; transform: rotateY(180deg); }

        /* Forca */
        .hangman-part { transition: opacity 0.5s ease-in-out, stroke 0.3s; stroke: #374151; stroke-width: 4; stroke-linecap: round; }
        .hangman-part-error { stroke: #ef4444; }

        @media print {
            .no-print { display: none !important; }
            body * { visibility: hidden; }
            #printable-area, #printable-area * { visibility: visible; }
            #printable-area { position: absolute; left: 0; top: 0; width: 100%; margin: 0; padding: 0; background: white; }
        }

        /* --- ESTILOS DO EST√öDIO CLEAN EDITION (V31.1) --- */
        .studio-wrapper {
            --primary: #e11d48; --primary-light: #ffebf0;
            --bg-body: #f4f6f9; --bg-card: #ffffff; 
            --text-main: #1e293b; --text-sec: #64748b;
            --border: #e2e8f0; --input-bg: #f8fafc; 
            --shadow: 0 10px 40px -10px rgba(0,0,0,0.08);
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        .studio-wrapper[data-theme="dark"] { 
            --primary: #fb7185; --primary-light: #2d1b20;
            --bg-body: #0f172a; --bg-card: #1e293b; 
            --text-main: #f1f5f9; --text-sec: #94a3b8;
            --border: #334155; --input-bg: #334155; 
            --shadow: 0 10px 40px -10px rgba(0,0,0,0.5);
        }

        /* Particles */
        .studio-particles { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; overflow: hidden; }
        .particle { position: absolute; background: var(--primary); border-radius: 50%; opacity: 0.2; animation: floatUp linear infinite; }
        @keyframes floatUp { 0% { transform: translateY(100vh) scale(0); opacity: 0; } 50% { opacity: 0.5; } 100% { transform: translateY(-10vh) scale(1); opacity: 0; } }

        /* Header Studio */
        .studio-header { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(20px); padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); position: relative; z-index: 10; }
        .studio-wrapper[data-theme="dark"] .studio-header { background: rgba(15, 23, 42, 0.8); }
        
        .streak-badge { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 6px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; display: flex; align-items: center; gap: 6px; box-shadow: 0 4px 10px rgba(245, 158, 11, 0.3); cursor: pointer; transition: transform 0.2s; }
        .streak-badge:active { transform: scale(0.95); }

        .studio-container { padding: 20px; max-width: 600px; margin: 0 auto; position: relative; z-index: 5; padding-bottom: 120px; }
        
        /* Tools Section */
        .tools-section { background: var(--bg-card); padding: 20px; border-radius: 24px; border: 1px solid var(--border); margin-bottom: 20px; box-shadow: var(--shadow); position: relative; z-index: 1; }
        .section-title { font-size: 0.8rem; font-weight: 700; color: var(--text-sec); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }

        .search-row { display: flex; gap: 10px; margin-bottom: 15px; position: relative; }
        .search-icon { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--text-sec); opacity: 0.5; }
        .search-input { flex: 1; padding: 14px 14px 14px 40px; border-radius: 16px; border: 1px solid var(--border); background: var(--input-bg); color: var(--text-main); outline: none; transition: 0.3s; margin-bottom: 0; }
        .track-input { width: 100%; padding: 16px; border-radius: 18px; border: 1px solid var(--border); background: var(--input-bg); color: var(--text-main); font-size: 1rem; outline: none; margin-top: 5px; }
        
        .btn-magic { background: linear-gradient(135deg, var(--primary), #db2777); color: white; border: none; width: 54px; border-radius: 16px; cursor: pointer; font-size: 1.2rem; box-shadow: 0 4px 15px rgba(225, 29, 72, 0.3); transition: 0.2s; display: flex; align-items: center; justify-content: center; }
        
        /* Card Preview Styles */
        .preview-container-3d { perspective: 1000px; width: 100%; display: flex; justify-content: center; margin-bottom: 25px; margin-top: 20px; }
        .card-preview-wrapper { width: 100%; aspect-ratio: 4/5; border-radius: 32px; text-align: center; position: relative; overflow: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 40px; background-color: white; box-shadow: 0 20px 60px -10px rgba(0,0,0,0.25); transform-style: preserve-3d; transition: transform 0.1s ease-out; border: 1px solid rgba(255,255,255,0.2); }
        
        .card-overlay { position: absolute; top:0; left:0; width:100%; height:100%; z-index: 1; pointer-events: none; transition: 0.3s; transform: translateZ(0); }
        .dimmer-light { background: rgba(0,0,0,0.2); }
        .dimmer-heavy { background: rgba(0,0,0,0.5); }
        
        .card-content-layer { position: relative; z-index: 5; width: 100%; transform: translateZ(30px); text-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .pv-title { font-size: 1.8rem; font-weight: 800; margin-bottom: 12px; line-height: 1.1; letter-spacing: -0.5px; }
        .pv-ref { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; opacity: 0.8; margin-bottom: 6px; font-weight: 600; }
        .pv-verse { font-style: italic; opacity: 0.9; margin-bottom: 15px; display: block; font-size: 0.9em; }
        .pv-msg { padding: 30px; border-radius: 24px; font-size: 0.95rem; line-height: 1.7; margin-bottom: 30px; background: rgba(255,255,255,0.9); backdrop-filter: blur(15px); color: #333; min-height: 100px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); transition: 0.3s; }
        .pv-footer { font-size: 0.7rem; opacity: 0.75; text-transform: uppercase; margin-top: auto; display: flex; align-items: center; justify-content: center; gap: 6px; font-weight: 600; letter-spacing: 0.5px; }
        
        /* CURSOR BLINK (M√°quina de Escrever) */
        .cursor-blink { display: inline-block; width: 2px; height: 1em; background-color: currentColor; margin-left: 2px; animation: blink 1s step-end infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        .card-sticker { position: absolute; top: 25px; right: 25px; z-index: 10; background: rgba(255,255,255,0.95); padding: 8px 16px; border-radius: 30px; font-size: 0.75rem; font-weight: 800; color: var(--primary); text-transform: uppercase; letter-spacing: 1px; box-shadow: 0 8px 20px rgba(0,0,0,0.15); display: none; backdrop-filter: blur(5px); transform: translateZ(20px); }
        .card-sticker.visible { display: block; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* Draggable */
        .draggable-item { cursor: grab; touch-action: none; position: relative; z-index: 10; user-select: none; transition: transform 0.05s linear; }
        .draggable-item:active { cursor: grabbing; z-index: 50; }

        /* Formatos */
        .fmt-feed { aspect-ratio: 4/5; border-radius: 28px; }
        .fmt-square { aspect-ratio: 1/1; border-radius: 28px; }
        .fmt-story { aspect-ratio: 9/16; border-radius: 0; }
        .fmt-music { aspect-ratio: 4/5; border-radius: 24px; }

        /* Frames */
        .frame-white { border: 12px solid #ffffff; }
        .frame-black { border: 12px solid #1e293b; }
        .frame-gold { border: 12px solid #d4af37; box-shadow: inset 0 0 20px rgba(184, 134, 11, 0.5); }
        .frame-wood { border: 15px solid #8b4513; border-radius: 4px !important; }
        .frame-neon-pink { border: 4px solid #ff00ff; box-shadow: 0 0 15px #ff00ff, inset 0 0 15px #ff00ff; }
        .frame-neon-blue { border: 4px solid #00ffff; box-shadow: 0 0 15px #00ffff, inset 0 0 15px #00ffff; }
        .frame-double { border: 8px solid white; outline: 4px solid rgba(0,0,0,0.1); outline-offset: -14px; }
        .frame-modern-y { border-top: 20px solid var(--primary); border-bottom: 20px solid var(--primary); }
        .frame-modern-x { border-left: 20px solid var(--primary); border-right: 20px solid var(--primary); }
        .frame-polaroid-clean { border: 15px solid white; border-bottom-width: 50px; border-radius: 2px !important; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        
        /* Bottom Nav Studio */
        .studio-bottom-nav { position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%); width: 85%; max-width: 380px; height: 70px; background: rgba(30, 41, 59, 0.85); backdrop-filter: blur(20px); border-radius: 40px; display: flex; justify-content: space-around; align-items: center; z-index: 1000; box-shadow: 0 15px 40px rgba(0,0,0,0.3); }
        .studio-nav-item { background: none; border: none; color: rgba(255,255,255,0.4); font-size: 1.3rem; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: 0.3s; }
        .studio-nav-item.active { background: var(--primary); color: white; transform: translateY(-5px); box-shadow: 0 8px 20px rgba(225, 29, 72, 0.4); }

        /* Helpers */
        .cat-scroll { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 15px; scrollbar-width: none; }
        .cat-chip { background: var(--input-bg); padding: 8px 16px; border-radius: 20px; font-size: 0.8rem; white-space: nowrap; cursor: pointer; border: 1px solid var(--border); font-weight: 600; color: var(--text-sec); }
        .cat-chip:hover { background: var(--primary); color: white; border-color: var(--primary); }

        .format-bar { display: flex; gap: 8px; justify-content: center; margin-bottom: 15px; background: var(--bg-card); padding: 6px; border-radius: 20px; border: 1px solid var(--border); box-shadow: var(--shadow); }
        .fmt-btn { flex: 1; padding: 10px; border-radius: 14px; background: transparent; color: var(--text-sec); font-size: 0.8rem; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; transition: 0.2s; }
        .fmt-btn.active { background: var(--text-main); color: var(--bg-body); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }

        /* Themes & Colors */
        .t-clean { background: white; color: #1e293b; } .t-clean .pv-title { color: #e11d48; }
        .t-dark { background: #0f172a; color: white; } .t-dark .pv-msg { background: rgba(255,255,255,0.1); color: #e2e8f0; border: 1px solid rgba(255,255,255,0.1); } .t-dark .pv-title { color: #818cf8; }
        .t-gold { background: linear-gradient(135deg, #FDEB71 0%, #F8D800 100%); color: #5c4a08; } .t-gold .pv-msg { background: rgba(255,255,255,0.6); color: #423602; }
        .t-ocean { background: linear-gradient(to top, #30cfd0 0%, #330867 100%); color: white; } .t-ocean .pv-msg { background: rgba(255,255,255,0.15); color:white; border: 1px solid rgba(255,255,255,0.2); }
        .t-nature { background: linear-gradient(120deg, #d4fc79 0%, #96e6a1 100%); color: #14532d; } .t-nature .pv-msg { background: rgba(255,255,255,0.7); }
        .t-sunset { background: linear-gradient(to right, #fa709a 0%, #fee140 100%); color: #7f1d1d; } .t-sunset .pv-msg { background: rgba(255,255,255,0.8); }
        .t-royal { background: linear-gradient(to right, #6a11cb 0%, #2575fc 100%); color: white; } .t-royal .pv-msg { background: rgba(255,255,255,0.15); color:white; border: 1px solid rgba(255,255,255,0.2); }
        .t-berry { background: linear-gradient(to top, #f43b47 0%, #453a94 100%); color: white; } .t-berry .pv-msg { background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.2); }
        .t-mint { background: linear-gradient(120deg, #84fab0 0%, #8fd3f4 100%); color: #0f766e; } .t-mint .pv-msg { background: rgba(255,255,255,0.6); }

        /* Fontes Studio */
        .font-modern .pv-title { font-family: 'Poppins', sans-serif; } 
        .font-classic .pv-title { font-family: 'Playfair Display', serif; } 
        .font-hand .pv-title { font-family: 'Dancing Script', cursive; font-size: 2.6rem; }
        .font-bold .pv-title { font-family: 'Bebas Neue', sans-serif; font-size: 3.5rem; letter-spacing: 1px; }
        .font-marker .pv-title { font-family: 'Permanent Marker', cursive; font-size: 2.2rem; }

        /* Actions Grid */
        .actions-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .btn-action { border: none; padding: 18px; border-radius: 18px; font-weight: 600; color: white; display: flex; align-items: center; justify-content: center; gap: 10px; cursor: pointer; transition: 0.2s; font-size: 1rem; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .btn-share { background: #25D366; grid-column: span 2; }
        .btn-audio { background: #f43f5e; color: white; grid-column: span 2; }
        .btn-save { background: #3b82f6; } .btn-print { background: #64748b; } .btn-copy { background: #94a3b8; }

        /* Slider Box */
        .slider-box { background: var(--bg-card); border: 1px solid var(--border); border-radius: 20px; padding: 15px; margin-bottom: 20px; display: flex; flex-direction: column; gap: 15px; box-shadow: var(--shadow); }
        .slider-row { display: flex; gap: 15px; }
        .slider-wrapper { flex: 1; display: flex; flex-direction: column; gap: 8px; }
        .slider-label { font-size: 0.65rem; font-weight: 800; color: var(--text-sec); text-transform: uppercase; }
        input[type=range] { width: 100%; -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 18px; width: 18px; border-radius: 50%; background: var(--primary); cursor: pointer; margin-top: -7px; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: var(--border); border-radius: 2px; }

        /* Music Overlay */
        .music-overlay { position: absolute; bottom: 20px; left: 0; width: 100%; padding: 0 30px; z-index: 8; display: none; flex-direction: column; gap: 8px; transform: translateZ(10px); }
        .fmt-music .music-overlay { display: flex; }
        .fmt-music .pv-footer { display: none; }
        .music-bar { width: 100%; height: 4px; background: rgba(255,255,255,0.3); border-radius: 2px; }
        .music-progress { width: 65%; height: 100%; background: white; border-radius: 2px; }
        .music-time { display: flex; justify-content: space-between; font-size: 0.6rem; color: rgba(255,255,255,0.8); font-weight: 600; margin-top: 4px; font-family: 'Montserrat', sans-serif; }
        .music-controls { display: flex; justify-content: center; gap: 20px; align-items: center; margin-top: 5px; color: white; font-size: 1.2rem; }

        /* Emoji Grid */
        .emoji-grid { display: none; grid-template-columns: repeat(8, 1fr); gap: 5px; background: var(--bg-card); padding: 10px; border-radius: 16px; border: 1px solid var(--border); margin-top: 10px; max-height: 180px; overflow-y: auto; }
        .emoji-grid.show { display: grid; }
        .emoji-item { font-size: 1.5rem; cursor: pointer; padding: 6px; text-align: center; border-radius: 8px; }
        .emoji-item:hover { background: var(--input-bg); transform: scale(1.2); }

        /* Scroll Tools */
        .scroll-tools { display: flex; flex-direction: column; gap: 12px; margin-bottom: 25px; }
        .tool-row { display: flex; gap: 10px; overflow-x: auto; scrollbar-width: none; padding: 4px 2px 10px 2px; white-space: nowrap; }
        .tool-btn { flex: 0 0 auto; padding: 10px 18px; border-radius: 14px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-sec); font-size: 0.85rem; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
        .tool-btn:active { transform: scale(0.95); }
        .tool-btn.active { background: var(--primary-light); color: var(--primary); border-color: var(--primary); box-shadow: 0 4px 10px rgba(225, 29, 72, 0.15); }

        .preview-controls { display: flex; flex-direction: row; flex-wrap: nowrap; gap: 14px; overflow-x: auto; align-items: center; scrollbar-width: none; padding: 10px 5px 25px 5px; margin-bottom: 0; }
        .theme-btn { flex: 0 0 auto; width: 60px; height: 60px; border-radius: 18px; border: 3px solid transparent; cursor: pointer; position: relative; background-size: cover; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; color: rgba(255,255,255,0.9); box-shadow: 0 5px 15px rgba(0,0,0,0.1); transition: 0.3s; }
        .theme-btn:hover { transform: translateY(-3px); }
        .theme-btn.active { border-color: var(--primary); transform: scale(1.1); box-shadow: 0 10px 25px rgba(225, 29, 72, 0.3); z-index: 10; }
        .theme-btn.upload-btn { border: 2px dashed var(--text-sec); color: var(--text-sec); box-shadow: none; background: var(--input-bg); }
        .theme-btn.magic-btn { background: linear-gradient(135deg, #a855f7, #ec4899); color: white; border: none; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, Component, useMemo } = React;

        // --- ERROR BOUNDARY ---
        class ErrorBoundary extends Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false };
            }
            static getDerivedStateFromError(error) { return { hasError: true }; }
            render() {
                if (this.state.hasError) return <div className="p-8 text-center text-red-800"><h1>Algo correu mal.</h1><button onClick={()=>window.location.reload()} className="mt-4 bg-red-700 text-white px-4 py-2 rounded">Recarregar</button></div>;
                return this.props.children;
            }
        }
        
        // --- PERSIST√äNCIA ---
        function usePersistentState(key, initialValue) {
            const [state, setState] = useState(() => {
                try { const item = localStorage.getItem(key); return item ? JSON.parse(item) : initialValue; } catch { return initialValue; }
            });
            useEffect(() => { try { localStorage.setItem(key, JSON.stringify(state)); } catch {} }, [key, state]);
            return [state, setState];
        }

        // --- SONS ---
        const playSoundEffect = (type) => {
            try {
                const now = Tone.now();
                if (type === 'correct' || type === 'quiz_correct' || type === 'hangman_correct') {
                    const synth = new Tone.Synth({ oscillator: { type: 'triangle' } }).toDestination();
                    synth.triggerAttackRelease('E5', '16n', now);
                } else if (type === 'wrong' || type === 'quiz_wrong' || type === 'hangman_wrong') {
                    const synth = new Tone.Synth({ oscillator: { type: 'square' } }).toDestination();
                    synth.triggerAttackRelease('A2', '8n', now);
                } else if (type === 'win') {
                    const synth = new Tone.PolySynth(Tone.Synth).toDestination();
                    synth.triggerAttackRelease(["C4", "E4", "G4", "C5"], "4n");
                } else if (type === 'lose') {
                    const synth = new Tone.Synth().toDestination();
                    synth.triggerAttackRelease('C3', '4n', now);
                }
            } catch (e) {}
        };

        // --- √çCONES ---
        const icons = {
            'home': <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />,
            'book-open': <><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></>,
            'user': <><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></>,
            'gamepad-2': <><line x1="6" x2="10" y1="12" y2="12" /><line x1="8" x2="8" y1="10" y2="14" /><line x1="15" x2="15.01" y1="13" y2="13" /><line x1="18" x2="18.01" y1="11" y2="11" /><rect width="20" height="12" x="2" y="6" rx="2" /></>,
            'qr-code': <><rect width="5" height="5" x="3" y="3" rx="1" /><rect width="5" height="5" x="16" y="3" rx="1" /><rect width="5" height="5" x="3" y="16" rx="1" /><path d="M21 16h-3a2 2 0 0 0-2 2v3" /><path d="M21 21v.01" /><path d="M12 7v3a2 2 0 0 1-2 2H7" /><path d="M3 12h.01" /><path d="M12 3h.01" /><path d="M12 16v.01" /><path d="M16 12h1" /><path d="M21 12v.01" /><path d="M12 21v-1" /></>,
            'radio': <><circle cx="12" cy="12" r="2" /><path d="M16.24 7.76a6 6 0 0 1 0 8.49" /><path d="M19.07 4.93a10 10 0 0 1 0 14.14" /></>,
            'calendar': <><rect x="3" y="4" width="18" height="18" rx="2" ry="2" /><line x1="16" y1="2" x2="16" y2="6" /><line x1="8" y1="2" x2="8" y2="6" /><line x1="3" y1="10" x2="21" y2="10" /></>,
            'megaphone': <><path d="m3 11 18-5v12L3 14v-3z" /><path d="M11.6 16.8a3 3 0 1 1-5.8-1.6" /></>,
            'menu': <><line x1="4" x2="20" y1="12" y2="12" /><line x1="4" x2="20" y1="6" y2="6" /><line x1="4" x2="20" y1="18" y2="18" /></>,
            'arrow-left': <><line x1="19" y1="12" x2="5" y2="12" /><polyline points="12 19 5 12 12 5" /></>,
            'chevron-left': <path d="m15 18-6-6 6-6" />,
            'chevron-right': <path d="m9 18 6-6-6-6" />,
            'check-circle': <><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" /></>,
            'volume-2': <><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5" /><path d="M19.07 4.93a10 10 0 0 1 0 14.14" /><path d="M15.54 8.46a5 5 0 0 1 0 7.07" /></>,
            'square': <rect width="18" height="18" x="3" y="3" rx="2" />,
            'refresh-cw': <><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" /><path d="M21 3v5h-5" /><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" /><path d="M8 16H3v5" /></>,
            'copy': <><rect x="9" y="9" width="13" height="13" rx="2" ry="2" /><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" /></>,
            'zap': <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />,
            'help-circle': <><circle cx="12" cy="12" r="10" /><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" /><line x1="12" y1="17" x2="12.01" y2="17" /></>,
            'search': <><circle cx="11" cy="11" r="8" /><path d="m21 21-4.3-4.3" /></>,
            'download': <><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" x2="12" y1="15" y2="3" /></>,
            'trash-2': <><polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /><line x1="10" y1="11" x2="10" y2="17" /><line x1="14" y1="11" x2="14" y2="17" /></>
        };

        const IconWrapper = ({ name, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} style={{ display: 'inline-block', verticalAlign: 'middle' }}>
                {icons[name] || null}
            </svg>
        );

        // --- DADOS PARA A FORCA ---
        const HANGMAN_CATEGORIES = {
            'B√çBLICO': ['GOLIAS', 'MOISES', 'ABRAAO', 'SAMUEL', 'SALOMAO', 'MATEUS', 'GABRIEL', 'JERUSALEM', 'GENESIS', 'PENTATEUCO', 'TABERNACULO', 'ARCA', 'SINAI', 'EGITO', 'MANA', 'JORDANIA', 'JERICO', 'DANIEL', 'ESTRELA', 'BETANIA'],
            'FRUTAS': ['MELANCIA', 'ABACAXI', 'BANANA', 'MORANGO', 'LARANJA', 'UVA', 'MANGA', 'PERA', 'ABACATE', 'PITAYA', 'TAMARINDO', 'CEREJA', 'GOIABA'],
            'ANIMAIS': ['CACHORRO', 'GIRAFA', 'ELEFANTE', 'LEAO', 'MACACO', 'TIGRE', 'ZEBRA', 'COELHO', 'GATO', 'ORNITORRINCO', 'CANGURU', 'ESCORPIAO'],
            'PA√çSES': ['PORTUGAL', 'BRASIL', 'ARGENTINA', 'CANADA', 'JAPAO', 'ITALIA', 'FRAN√áA', 'CHINA', 'EGITO', 'ANGOLA', 'MO√áAMBIQUE', 'GRECIA']
        };

        const bibleQuizDatabase = [
            { question: "Quem construiu a arca?", options: ["Mois√©s", "No√©", "Abra√£o", "Davi"], answer: 1 },
            { question: "Qual √© o primeiro livro da B√≠blia?", options: ["Mateus", "Apocalipse", "G√™nesis", "√äxodo"], answer: 2 },
            { question: "Quem derrotou o gigante Golias?", options: ["Davi", "Saul", "Salom√£o", "Sans√£o"], answer: 0 },
            { question: "Onde Jesus nasceu?", options: ["Nazar√©", "Jerusal√©m", "Bel√©m", "Galileia"], answer: 2 },
            { question: "Quem foi engolido por um grande peixe?", options: ["Pedro", "Jonas", "Paulo", "Jo√£o"], answer: 1 },
            { question: "Qual o nome da esposa de Abra√£o?", options: ["Raquel", "Rebeca", "Sara", "Lia"], answer: 2 },
            { question: "Quantos mandamentos Deus deu a Mois√©s?", options: ["5", "7", "10", "12"], answer: 2 },
            { question: "Quem traiu Jesus?", options: ["Pedro", "Judas iScariotes", "Tiago", "Tom√©"], answer: 1 },
            { question: "Quem abriu o Mar Vermelho?", options: ["Elias", "Mois√©s", "Josu√©", "Ar√£o"], answer: 1 },
            { question: "Qual profeta foi levado ao c√©u numa carruagem de fogo?", options: ["Elias", "Eliseu", "Isa√≠as", "Jeremias"], answer: 0 }
        ];

        const preachingDatabase = [
            { 
                ref: "Jo√£o 3:16", 
                theme: "O Amor Incompar√°vel de Deus", 
                intro: "Este vers√≠culo √© o cora√ß√£o do Evangelho, revelando a motiva√ß√£o m√°xima de Deus: o Amor.",
                points: [
                    "A Origem do Amor: Tudo come√ßa em Deus.",
                    "A Extens√£o do Amor: 'Amou o mundo de tal maneira'.",
                    "O Sacrif√≠cio do Amor: Entregou o Seu √∫nico Filho.",
                    "O Objetivo do Amor: Vida eterna para todo aquele que cr√™."
                ],
                conclusion: "O amor de Deus exige uma resposta de f√©. Aceite este presente hoje."
            },
            { 
                ref: "Salmos 23:1", 
                theme: "O Senhor √© o meu Pastor", 
                intro: "Davi descreve a sufici√™ncia de Deus em todas as fases da vida.",
                points: [
                    "Relacionamento Pessoal: 'O Senhor √© o MEU pastor'.",
                    "Provis√£o Plena: 'Nada me faltar√°'.",
                    "Descanso e Refrig√©rio: √Åguas tranquilas e pastos verdejantes.",
                    "Seguran√ßa na Crise: 'Ainda que eu andasse pelo vale da morte'."
                ],
                conclusion: "Sob o cuidado do Bom Pastor, a nossa jornada est√° segura."
            },
            { 
                ref: "Filipenses 4:13", 
                theme: "A Fonte da Nossa For√ßa", 
                intro: "Paulo escreve sobre o contentamento e a for√ßa que vem de Cristo, mesmo na pris√£o.",
                points: [
                    "A Depend√™ncia Correta: N√£o √© auto-ajuda, √© ajuda do alto.",
                    "A Capacidade em Cristo: 'Tudo posso'.",
                    "O Fortalecedor: A presen√ßa constante de Jesus.",
                    "Superando Circunst√¢ncias: For√ßa para abund√¢ncia ou escassez."
                ],
                conclusion: "A nossa vit√≥ria n√£o depende das circunst√¢ncias, mas de Quem nos fortalece."
            }
        ];

        const NAV_ITEMS = [
            { id: 'home', label: 'In√≠cio', icon: 'home' },
            { id: 'bible', label: 'B√≠blia', icon: 'book-open' },
            { id: 'names', label: 'Nomes', icon: 'user' },
            { id: 'preaching', label: 'Prega√ß√£o', icon: 'megaphone' },
            { id: 'games', label: 'Jogos', icon: 'gamepad-2' },
            { id: 'studio', label: 'Est√∫dio', icon: 'magic' }, 
            { id: 'qrcode', label: 'QR Code', icon: 'qr-code' },
            { id: 'radio', label: 'R√°dio', icon: 'radio' },
            { id: 'notes', label: 'Di√°rio', icon: 'calendar' }
        ];

        const nameDatabase = { 
            "ana": "Cheia de gra√ßa e compaix√£o.", 
            "maria": "Soberana, senhora ou pura.", 
            "jo√£o": "Deus √© misericordioso.",
            "pedro": "Rocha ou pedra.",
            "paulo": "Pequeno ou humilde.",
            "lucas": "Luminoso ou iluminado."
        };
        
        const bibleBooks = ["G√™nesis", "√äxodo", "Lev√≠tico", "N√∫meros", "Deuteron√¥mio", "Josu√©", "Ju√≠zes", "Rute", "1 Samuel", "2 Samuel", "1 Reis", "2 Reis", "1 Cr√¥nicas", "2 Cr√¥nicas", "Esdras", "Neemias", "Ester", "J√≥", "Salmos", "Prov√©rbios", "Eclesiastes", "C√¢nticos", "Isa√≠as", "Jeremias", "Lamenta√ß√µes", "Ezequiel", "Daniel", "Oseias", "Joel", "Am√≥s", "Obadias", "Jonas", "Miqueias", "Naum", "Habacuque", "Sofonias", "Ageu", "Zacarias", "Malaquias", "Mateus", "Marcos", "Lucas", "Jo√£o", "Atos", "Romanos", "1 Cor√≠ntios", "2 Cor√≠ntios", "G√°latas", "Ef√©sios", "Filipenses", "Colossenses", "1 Tessalonicenses", "2 Tessalonicenses", "1 Tim√≥teo", "2 Tim√≥teo", "Tito", "Filemom", "Hebreus", "Tiago", "1 Pedro", "2 Pedro", "1 Jo√£o", "2 Jo√£o", "3 Jo√£o", "Judas", "Apocalipse"];

        function formatarEMV(id, value) { const length = ('00' + value.length).slice(-2); return `${id}${length}${value}`; }
        function simplificarTexto(text) { return text.normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[^\w\s]/g, ''); }
        function crc16(data) { let crc = 0xFFFF; for (let i = 0; i < data.length; i++) { crc ^= data.charCodeAt(i) << 8; for (let j = 0; j < 8; j++) { crc = (crc & 0x8000) ? (crc << 1) ^ 0x1021 : crc << 1; } } return ('0000' + (crc & 0xFFFF).toString(16).toUpperCase()).slice(-4); }

        // --- COMPONENTE DO EST√öDIO (PROJETO 2 - V31.1 Clean Edition) ---
        const CardStudio = ({ onExit }) => {
            const [activeScreen, setActiveScreen] = useState('editor');
            const [themeMode, setThemeMode] = useState('light');
            const [streak, setStreak] = useState(0);
            const [emojiOpen, setEmojiOpen] = useState(false);
            const [isTypewriter, setIsTypewriter] = useState(true); // Estado para m√°quina de escrever
            
            const [cardData, setCardData] = useState({
                titulo: 'Bom Dia',
                versiculo: 'Tudo posso naquele que me fortalece.',
                referencia: 'Filipenses 4:13',
                mensagem: 'Que o seu dia seja iluminado e cheio de vit√≥rias!',
                autor: 'Sistema Vida',
                fontSize: 16,
                blur: 0,
                opacity: 90,
                themeClass: 't-clean',
                frameClass: '',
                fontClass: 'font-modern',
                formatClass: 'fmt-feed',
                bgImage: null,
                sticker: '',
                isBw: false,
                align: 'align-center',
                dim: false
            });

            const dbMsg = [
                { tags: "financeiro dinheiro sucesso", titulo: "Deus Prover√°", ref: "Filipenses 4:19", msg: "Sua conta banc√°ria n√£o limita o poder de Deus. A provis√£o est√° a caminho." },
                { tags: "sucesso trabalho foco", titulo: "N√£o Desista", ref: "G√°latas 6:9", msg: "O sucesso √© a soma de pequenos esfor√ßos repetidos dia ap√≥s dia. Continue plantando." },
                { tags: "ansiedade medo paz", titulo: "Paz Real", ref: "Jo√£o 14:27", msg: "Respire fundo. O controle do universo est√° nas m√£os de quem te ama." },
                { tags: "fam√≠lia casa amor", titulo: "Lar Protegido", ref: "Josu√© 24:15", msg: "Deus est√° levantando muros de prote√ß√£o ao redor da sua fam√≠lia hoje." },
                { tags: "sa√∫de cura gym treino", titulo: "For√ßa Renovada", ref: "Isa√≠as 40:29", msg: "Seu corpo √© templo. Cuide dele com respeito e disciplina. Voc√™ √© mais forte do que imagina." },
                { tags: "gratid√£o f√©", titulo: "Novo F√¥lego", ref: "Lamenta√ß√µes 3:22", msg: "Voc√™ acordou! Isso √© a prova de que Deus ainda n√£o terminou com voc√™." }
            ];

            const emojis = ["üôè", "üôå", "‚ú®", "‚ù§Ô∏è", "‚úùÔ∏è", "üïäÔ∏è", "üìñ", "üî•", "üí°", "üòä", "üí™", "üõ°Ô∏è", "üëë", "üåø", "üåü", "üíñ", "ü§ù", "üò≠", "üåª", "üòá", "ü¶Å", "üåà", "‚òÄÔ∏è", "üöÄ", "üí∞", "üíº", "üß†"];
            const magicBackgrounds = ["https://images.unsplash.com/photo-1519681393798-3828fb4090bb?q=80&w=1000", "https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?q=80&w=1000", "https://images.unsplash.com/photo-1506744038136-46273834b3fb?q=80&w=1000"];
            
            // New theme and font arrays for randomization
            const themes = ['t-clean', 't-dark', 't-ocean', 't-nature', 't-gold', 't-sunset', 't-royal', 't-berry', 't-mint'];
            const fonts = ['font-modern', 'font-classic', 'font-hand', 'font-bold', 'font-marker'];

            // Init Streak & Particles
            useEffect(() => {
                const container = document.getElementById('studio-particles');
                if(container && container.innerHTML === '') {
                    for(let i=0; i<15; i++) {
                        const p = document.createElement('div');
                        p.className = 'particle';
                        const size = Math.random() * 5 + 2;
                        p.style.width = size + 'px'; p.style.height = size + 'px';
                        p.style.left = Math.random() * 100 + '%';
                        p.style.animationDuration = (Math.random() * 10 + 10) + 's';
                        p.style.animationDelay = (Math.random() * 5) + 's';
                        container.appendChild(p);
                    }
                }
                // Streak Logic
                let last = localStorage.getItem('lastVisit');
                let s = parseInt(localStorage.getItem('streak') || 0);
                const today = new Date().toDateString();
                if (last !== today) { 
                    const yesterday = new Date(Date.now() - 86400000).toDateString();
                    if (last === yesterday) s++; else s = 1;
                    localStorage.setItem('lastVisit', today); localStorage.setItem('streak', s); 
                }
                setStreak(s);
            }, []);

            // Drag Logic
            useEffect(() => {
                if(activeScreen === 'preview') {
                    // 3D Tilt
                    const container = document.getElementById('card-container-3d');
                    const card = document.getElementById('card-capture');
                    if(container && card) {
                        const handleMove = (e) => {
                            const rect = container.getBoundingClientRect();
                            const x = e.clientX - rect.left; const y = e.clientY - rect.top;
                            const centerX = rect.width / 2; const centerY = rect.height / 2;
                            const rotateX = ((y - centerY) / centerY) * -10; 
                            const rotateY = ((x - centerX) / centerX) * 10;
                            card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
                        };
                        const handleLeave = () => card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0)';
                        container.addEventListener('mousemove', handleMove);
                        container.addEventListener('mouseleave', handleLeave);
                        return () => { container.removeEventListener('mousemove', handleMove); container.removeEventListener('mouseleave', handleLeave); }
                    }
                    
                    // Draggable Items
                    const draggables = document.querySelectorAll('.draggable-item');
                    draggables.forEach(el => {
                        let isDragging = false;
                        let startX, startY, initialX, initialY;

                        const start = (e) => {
                            isDragging = true;
                            startX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
                            startY = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY;
                            const style = window.getComputedStyle(el);
                            const matrix = new WebKitCSSMatrix(style.transform);
                            initialX = matrix.m41; initialY = matrix.m42;
                        };
                        const move = (e) => {
                            if(!isDragging) return;
                            e.preventDefault();
                            const cx = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
                            const cy = e.type === 'touchmove' ? e.touches[0].clientY : e.clientY;
                            el.style.transform = `translate(${initialX + (cx - startX)}px, ${initialY + (cy - startY)}px)`;
                        };
                        const end = () => isDragging = false;

                        el.addEventListener('mousedown', start); el.addEventListener('touchstart', start, {passive:false});
                        window.addEventListener('mousemove', move); window.addEventListener('touchmove', move, {passive:false});
                        window.addEventListener('mouseup', end); window.addEventListener('touchend', end);
                    });
                }
            }, [activeScreen]);

            // Helper Functions
            const gerarConteudo = (tag) => {
                const search = tag ? tag.toLowerCase() : document.querySelector('.search-input').value.toLowerCase();
                const pool = search ? dbMsg.filter(i => i.tags.includes(search)) : dbMsg;
                const item = pool.length ? pool[Math.floor(Math.random() * pool.length)] : dbMsg[0];
                setCardData(prev => ({ ...prev, titulo: item.titulo, referencia: item.ref, mensagem: item.msg }));
                setActiveScreen('preview');
            };
            
            const gerarAleatorio = () => {
                const item = dbMsg[Math.floor(Math.random() * dbMsg.length)];
                const randomTheme = themes[Math.floor(Math.random() * themes.length)];
                const randomFont = fonts[Math.floor(Math.random() * fonts.length)];
                
                setCardData(prev => ({
                    ...prev,
                    titulo: item.titulo,
                    referencia: item.ref,
                    mensagem: item.msg,
                    themeClass: randomTheme,
                    fontClass: randomFont,
                    bgImage: null // reset custom bg to show theme color
                }));
                setActiveScreen('preview');
                alert("‚ú® Nova inspira√ß√£o gerada!");
            };

            const downloadImage = () => {
                const card = document.getElementById('card-capture');
                const originalTransform = card.style.transform;
                card.style.transform = 'none';
                
                html2canvas(card, { scale: 3, backgroundColor: null, useCORS: true, allowTaint: true }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = 'sistema_vida_card.png';
                    link.href = canvas.toDataURL();
                    link.click();
                    card.style.transform = originalTransform; 
                });
            };

            const lerMensagem = () => {
                const text = `${cardData.titulo}. ${cardData.mensagem}`;
                const synth = window.speechSynthesis;
                if(synth.speaking) { synth.cancel(); return; }
                const utter = new SpeechSynthesisUtterance(text);
                utter.lang = 'pt-BR';
                synth.speak(utter);
            };

            const compartilhar = async () => {
                const card = document.getElementById('card-capture');
                const originalTransform = card.style.transform;
                card.style.transform = 'none';
                try {
                    const canvas = await html2canvas(card, { scale: 2, useCORS: true, allowTaint: true, backgroundColor: null });
                    canvas.toBlob(async (blob) => {
                        if (navigator.share) {
                            const file = new File([blob], "sistema_vida.png", { type: "image/png" });
                            navigator.share({ files: [file], title: 'Sistema Vida', text: 'Minha mensagem do dia!' });
                        } else {
                            const item = new ClipboardItem({ "image/png": blob });
                            await navigator.clipboard.write([item]);
                            alert("Imagem copiada! Cole no WhatsApp.");
                        }
                    });
                } catch(e) { alert("Erro ao compartilhar."); }
                card.style.transform = originalTransform;
            };

            const handleBgUpload = (e) => {
                if (e.target.files && e.target.files[0]) {
                    const reader = new FileReader();
                    reader.onload = (evt) => setCardData(prev => ({...prev, bgImage: evt.target.result, themeClass: 't-dark'}));
                    reader.readAsDataURL(e.target.files[0]);
                }
            };

            const magicBg = () => {
                const randomImg = magicBackgrounds[Math.floor(Math.random() * magicBackgrounds.length)];
                setCardData(prev => ({...prev, bgImage: randomImg, themeClass: 't-dark', dim: true}));
            };

            const insertEmoji = (emoji) => {
                setCardData(prev => ({...prev, mensagem: prev.mensagem + emoji}));
            };

            const resetPositions = () => {
                 document.querySelectorAll('.draggable-item').forEach(el => {
                    el.style.transform = 'translate(0, 0)';
                });
                alert("Posi√ß√µes Restauradas üîÑ");
            };

            return (
                <div className="studio-wrapper" data-theme={themeMode}>
                    <div id="studio-particles" className="studio-particles"></div>
                    
                    <div className="studio-header">
                        <div className="flex flex-col">
                            <span className="font-bold text-red-600 text-lg">Sistema Vida</span>
                            <span className="text-[10px] uppercase tracking-widest opacity-60">Clean 31.1</span>
                        </div>
                        <div className="streak-badge"><i className="fas fa-fire"></i> {streak} Dia</div>
                        <button onClick={onExit} className="text-xs bg-gray-200 px-3 py-1 rounded-full font-bold hover:bg-gray-300 ml-2">Sair</button>
                    </div>

                    <div className="studio-container">
                        {activeScreen === 'editor' && (
                            <div className="animate-fadeIn">
                                <div className="tools-section">
                                    <h3 className="text-xs font-bold text-gray-400 uppercase mb-3"><i className="fas fa-bolt text-yellow-500 mr-2"></i> Gerador R√°pido</h3>
                                    <div className="search-row">
                                        <i className="fas fa-search search-icon"></i>
                                        <input type="text" className="search-input" placeholder="Sobre o que quer falar?" />
                                        <button className="btn-magic" onClick={() => gerarConteudo()}><i className="fas fa-wand-magic-sparkles"></i></button>
                                    </div>
                                    <div className="cat-scroll">
                                        {['Sucesso', 'F√©', 'Ansiedade', 'Amor', 'Gratid√£o', 'Gym'].map(tag => (
                                            <div key={tag} className="cat-chip" onClick={() => gerarConteudo(tag)}>{tag}</div>
                                        ))}
                                    </div>
                                </div>

                                <div className="emoji-bar">
                                    <button onClick={()=>setEmojiOpen(!emojiOpen)} className="w-full bg-gray-100 p-3 rounded-xl text-xs font-bold text-gray-500 flex justify-center gap-2"><i className="far fa-smile"></i> Galeria de Emojis</button>
                                    <div className={`emoji-grid ${emojiOpen ? 'show' : ''}`}>
                                        {emojis.map(e => <div key={e} className="emoji-item" onClick={()=>insertEmoji(e)}>{e}</div>)}
                                    </div>
                                </div>

                                <div className="space-y-4">
                                    <div><label className="text-xs font-bold text-gray-500 uppercase">T√≠tulo</label><input className="track-input" value={cardData.titulo} onChange={e => setCardData({...cardData, titulo: e.target.value})} /></div>
                                    <div><label className="text-xs font-bold text-gray-500 uppercase">Vers√≠culo</label><textarea className="track-input" rows="2" value={cardData.versiculo} onChange={e => setCardData({...cardData, versiculo: e.target.value})}></textarea><input className="track-input mt-2" placeholder="Refer√™ncia" value={cardData.referencia} onChange={e => setCardData({...cardData, referencia: e.target.value})} /></div>
                                    <div><label className="text-xs font-bold text-gray-500 uppercase">Mensagem</label><textarea className="track-input" rows="4" value={cardData.mensagem} onChange={e => setCardData({...cardData, mensagem: e.target.value})}></textarea></div>
                                    <div><label className="text-xs font-bold text-gray-500 uppercase">Assinatura</label><input className="track-input" value={cardData.autor} onChange={e => setCardData({...cardData, autor: e.target.value})} /></div>
                                </div>
                                <div style={{height:'100px'}}></div>
                            </div>
                        )}

                        {activeScreen === 'preview' && (
                            <div className="animate-fadeIn pb-24">
                                <div className="top-nav-bar">
                                    <button className="btn-back" onClick={() => setActiveScreen('editor')}><i className="fas fa-arrow-left"></i> Voltar</button>
                                    <button className="btn-inspire" onClick={gerarAleatorio}><i className="fas fa-random"></i> Surpreenda-me</button>
                                </div>

                                <div className="slider-box">
                                    <div className="slider-row">
                                        <div className="slider-wrapper"><span className="slider-label">Tamanho</span><input type="range" min="12" max="32" value={cardData.fontSize} onChange={e => setCardData({...cardData, fontSize: e.target.value})} /></div>
                                        <div className="slider-wrapper"><span className="slider-label">Opacidade</span><input type="range" min="0" max="100" value={cardData.opacity} onChange={e => setCardData({...cardData, opacity: e.target.value})} /></div>
                                    </div>
                                    <div className="slider-wrapper"><span className="slider-label">Blur Fundo</span><input type="range" min="0" max="10" value={cardData.blur} onChange={e => setCardData({...cardData, blur: e.target.value})} /></div>
                                </div>

                                <div className="preview-container-3d" id="card-container-3d">
                                    <div id="card-capture" className={`card-preview-wrapper ${cardData.themeClass} ${cardData.frameClass} ${cardData.fontClass} ${cardData.formatClass} ${cardData.isBw ? 'filter-bw' : ''} ${cardData.align}`}
                                        style={{ backgroundImage: cardData.bgImage ? `url(${cardData.bgImage})` : '', backgroundSize: 'cover', backgroundPosition: 'center' }}>
                                        <div className={`card-sticker draggable-item ${cardData.sticker ? 'visible' : ''}`}>{cardData.sticker}</div>
                                        <div className={`card-overlay ${cardData.dim || cardData.bgImage ? 'dimmer-heavy' : ''}`} style={{backdropFilter: `blur(${cardData.blur}px)`}}></div>
                                        <div className="card-content-layer" style={{fontSize: `${cardData.fontSize}px`}}>
                                            <div className="pv-title draggable-item">{cardData.titulo}</div>
                                            <div className="pv-ref draggable-item">{cardData.referencia}</div>
                                            <div className="pv-verse draggable-item">"{cardData.versiculo}"</div>
                                            <div className="pv-msg draggable-item" style={{backgroundColor: `rgba(255,255,255, ${cardData.opacity/100})`}}>
                                                {/* L√≥gica Simples de Typewriter */}
                                                {cardData.mensagem}
                                                {isTypewriter && <span className="cursor-blink">|</span>}
                                            </div>
                                            <div className="pv-footer draggable-item"><i className="fas fa-heart text-red-500"></i> {cardData.autor} ‚Ä¢ {new Date().toLocaleDateString('pt-BR')}</div>
                                        </div>
                                        <div className="music-overlay">
                                            <div className="music-bar"><div className="music-progress"></div></div>
                                            <div className="music-time"><span>1:34</span><span>3:45</span></div>
                                            <div className="music-controls"><i className="fas fa-backward-step"></i><i className="fas fa-circle-play" style={{fontSize:'2.5rem'}}></i><i className="fas fa-forward-step"></i></div>
                                        </div>
                                    </div>
                                </div>

                                <div className="format-bar">
                                    <div className={`fmt-btn ${cardData.formatClass==='fmt-feed'?'active':''}`} onClick={()=>setCardData({...cardData, formatClass:'fmt-feed'})}><i className="far fa-square"></i> Feed</div>
                                    <div className={`fmt-btn ${cardData.formatClass==='fmt-music'?'active':''}`} onClick={()=>{setCardData({...cardData, formatClass:'fmt-music'}); magicBg(); alert("Modo M√∫sica Ativado üéµ");}}><i className="fab fa-spotify"></i> Music</div>
                                    <div className={`fmt-btn ${cardData.formatClass==='fmt-story'?'active':''}`} onClick={()=>setCardData({...cardData, formatClass:'fmt-story'})}><i className="fas fa-mobile-alt"></i> Stories</div>
                                </div>

                                <div className="preview-controls">
                                    <button className={`tool-btn ${cardData.frameClass === '' ? 'active' : ''}`} onClick={()=>setCardData({...cardData, frameClass: ''})}>üö´</button>
                                    <button className="tool-btn" onClick={()=>setCardData({...cardData, frameClass: 'frame-white'})}>‚¨ú</button>
                                    <button className="tool-btn" onClick={()=>setCardData({...cardData, frameClass: 'frame-black'})}>‚¨õ</button>
                                    <button className="tool-btn" onClick={()=>setCardData({...cardData, frameClass: 'frame-gold'})}>üëë</button>
                                    <button className="tool-btn" onClick={()=>setCardData({...cardData, frameClass: 'frame-neon-pink'})}>üîÆ</button>
                                    <button className="tool-btn" onClick={()=>setCardData({...cardData, frameClass: 'frame-polaroid-clean'})}>üì∏</button>
                                </div>

                                <div className="scroll-tools">
                                    <div className="tool-row">
                                        <button className="tool-btn" onClick={()=>setCardData({...cardData, sticker: ''})}><i className="fas fa-ban"></i></button>
                                        <button className="tool-btn" onClick={()=>setCardData({...cardData, sticker: 'Bom Dia ‚òÄÔ∏è'})}>Bom Dia</button>
                                        <button className="tool-btn" onClick={()=>setCardData({...cardData, sticker: 'Boa Noite üåô'})}>Boa Noite</button>
                                        <button className="tool-btn" onClick={()=>setCardData({...cardData, sticker: 'Gratid√£o üôè'})}>Gratid√£o</button>
                                        <button className="tool-btn" onClick={()=>setCardData({...cardData, sticker: 'F√© ‚úùÔ∏è'})}>F√©</button>
                                        <button className="tool-btn" onClick={()=>setCardData({...cardData, sticker: 'Vers√≠culo üìñ'})}>Vers√≠culo</button>
                                    </div>
                                    <div className="tool-row">
                                        <button className="tool-btn" onClick={()=>setCardData({...cardData, fontClass: 'font-hand'})}><i className="fas fa-font"></i> Fonte</button>
                                        <button className="tool-btn" onClick={resetPositions}><i className="fas fa-sync-alt"></i> Reset</button>
                                        <button className="tool-btn" onClick={()=>setIsTypewriter(!isTypewriter)}><i className="fas fa-keyboard"></i> Digitar</button>
                                        <button className="tool-btn" onClick={()=>setCardData({...cardData, align: cardData.align==='align-left'?'align-center':'align-left'})}><i className="fas fa-align-center"></i> Alinhar</button>
                                        <button className="tool-btn" onClick={()=>setCardData({...cardData, dim: !cardData.dim})}><i className="fas fa-adjust"></i> Sombra</button>
                                        <button className="tool-btn" onClick={()=>setCardData({...cardData, isBw: !cardData.isBw})}>P&B</button>
                                    </div>
                                </div>

                                <div className="preview-controls">
                                    <label className="theme-btn upload-btn"><i className="fas fa-camera"></i><input type="file" className="hidden" accept="image/*" onChange={handleBgUpload}/></label>
                                    <button className="theme-btn magic-btn" onClick={magicBg}><i className="fas fa-wand-magic-sparkles"></i></button>
                                    <div className="theme-btn t-clean active" onClick={()=>setCardData({...cardData, themeClass: 't-clean', bgImage: null})}></div>
                                    <div className="theme-btn t-dark" onClick={()=>setCardData({...cardData, themeClass: 't-dark', bgImage: null})}></div>
                                    <div className="theme-btn t-ocean" onClick={()=>setCardData({...cardData, themeClass: 't-ocean', bgImage: null})}></div>
                                    <div className="theme-btn t-nature" onClick={()=>setCardData({...cardData, themeClass: 't-nature', bgImage: null})}></div>
                                    <div className="theme-btn t-gold" onClick={()=>setCardData({...cardData, themeClass: 't-gold', bgImage: null})}></div>
                                    <div className="theme-btn t-sunset" onClick={()=>setCardData({...cardData, themeClass: 't-sunset', bgImage: null})}></div>
                                    <div className="theme-btn t-royal" onClick={()=>setCardData({...cardData, themeClass: 't-royal', bgImage: null})}></div>
                                    <div className="theme-btn t-berry" onClick={()=>setCardData({...cardData, themeClass: 't-berry', bgImage: null})}></div>
                                    <div className="theme-btn t-mint" onClick={()=>setCardData({...cardData, themeClass: 't-mint', bgImage: null})}></div>
                                </div>

                                <div className="actions-grid">
                                    <button className="btn-action btn-audio" onClick={lerMensagem}><i className="fas fa-volume-up"></i> Ouvir</button>
                                    <button className="btn-action btn-share" onClick={compartilhar}><i className="fab fa-whatsapp"></i> Enviar Zap</button>
                                    <button className="btn-action btn-save" onClick={downloadImage}><i className="fas fa-download"></i> Salvar</button>
                                    <button className="btn-action btn-copy" onClick={()=>{navigator.clipboard.writeText(cardData.mensagem); alert("Texto copiado!");}}><i className="fas fa-copy"></i> Copiar</button>
                                </div>
                            </div>
                        )}
                    </div>

                    <div className="studio-bottom-nav">
                        <button className={`studio-nav-item ${activeScreen === 'editor' ? 'active' : ''}`} onClick={() => setActiveScreen('editor')}><i className="fas fa-pen"></i></button>
                        <button className={`studio-nav-item ${activeScreen === 'preview' ? 'active' : ''}`} onClick={() => setActiveScreen('preview')}><i className="fas fa-image"></i></button>
                        <button className="studio-nav-item" onClick={() => setThemeMode(themeMode === 'light' ? 'dark' : 'light')}><i className={`fas fa-${themeMode === 'light' ? 'moon' : 'sun'}`}></i></button>
                    </div>
                </div>
            );
        };

        function App() {
            const [activeTab, setActiveTab] = useState('home');
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
            const [showToast, setShowToast] = useState(false);

            // Estados B√≠blia
            const [selectedBook, setSelectedBook] = usePersistentState('lastBook', 'G√™nesis');
            const [selectedChapter, setSelectedChapter] = usePersistentState('lastChapter', 1);
            const [chapterContent, setChapterContent] = useState(null);
            const [loadingBible, setLoadingBible] = useState(false);
            const [isSpeaking, setIsSpeaking] = useState(false);
            const [highlights, setHighlights] = usePersistentState('bibleHighlights', {});

            // Estados Jogos
            const [gameMode, setGameMode] = useState('menu');
            const [quizQuestions, setQuizQuestions] = useState([]);
            const [quizIndex, setQuizIndex] = useState(0);
            const [quizScore, setQuizScore] = useState(0);
            const [quizActive, setQuizActive] = useState(false);
            const [quizTimer, setQuizTimer] = useState(600);
            const [showQuizResult, setShowQuizResult] = useState(false);

            const [hangmanWord, setHangmanWord] = useState('');
            const [hangmanCategory, setHangmanCategory] = useState('');
            const [hangmanWrong, setHangmanWrong] = useState([]);
            const [hangmanGuessed, setHangmanGuessed] = useState([]);
            const [hangmanTimer, setHangmanTimer] = useState(120);
            const [hangmanStatus, setHangmanStatus] = useState('playing');
            const [hangmanStreak, setHangmanStreak] = usePersistentState('hangmanStreak', 0);
            const [hintUsed, setHintUsed] = useState(false);

            const [memoryCards, setMemoryCards] = useState([]);
            const [memoryFlipped, setMemoryFlipped] = useState([]);
            const [memoryMatched, setMemoryMatched] = useState([]);
            const [memoryWin, setMemoryWin] = useState(false);

            // Estados QR Code
            const [qrUrl, setQrUrl] = usePersistentState('qrUrl', '');
            const [qrWifiSsid, setQrWifiSsid] = usePersistentState('qrWifiSsid', '');
            const [qrWifiPass, setQrWifiPass] = usePersistentState('qrWifiPass', '');
            const [qrPixKey, setQrPixKey] = usePersistentState('qrPixKey', '');
            const [qrPixName, setQrPixName] = usePersistentState('qrPixName', '');
            const [qrPixCity, setQrPixCity] = usePersistentState('qrPixCity', '');
            const [qrPixAmount, setQrPixAmount] = usePersistentState('qrPixAmount', '');
            const qrCodeRef = useRef(null);

            // Estados Di√°rio (Melhorados)
            const [currentDate, setCurrentDate] = useState(new Date());
            const [diaryEntries, setDiaryEntries] = usePersistentState('diary', {});
            const [diarySearchTerm, setDiarySearchTerm] = useState('');

            // Outros
            const [isPlayingRadio, setIsPlayingRadio] = useState(false);
            const audioRef = useRef(null);
            const [inputName, setInputName] = usePersistentState('userInputName', '');
            const [nameResult, setNameResult] = useState(null);
            const [sermon, setSermon] = useState(null);

            // --- B√çBLIA ---
            const fetchChapter = async (book, chapter) => {
                setLoadingBible(true);
                try {
                    const response = await fetch(`https://bible-api.com/${encodeURIComponent(book)}+${chapter}?translation=almeida`);
                    const data = await response.json();
                    setChapterContent(data.verses);
                } catch { setChapterContent([{ verse: 1, text: "Erro na liga√ß√£o." }]); }
                finally { setLoadingBible(false); }
            };
            useEffect(() => { if(activeTab === 'bible') fetchChapter(selectedBook, selectedChapter); }, [selectedBook, selectedChapter, activeTab]);

            // --- QUIZ ---
            const startQuiz = () => {
                Tone.start();
                const shuffled = [...bibleQuizDatabase].sort(() => 0.5 - Math.random());
                setQuizQuestions(shuffled.slice(0, 10));
                setQuizIndex(0); setQuizScore(0); setQuizTimer(600); setQuizActive(true); setShowQuizResult(false); setGameMode('quiz');
            };

            useEffect(() => {
                let interval;
                if (quizActive && quizTimer > 0) { interval = setInterval(() => setQuizTimer(p => p - 1), 1000); }
                else if (quizTimer === 0 && quizActive) { setQuizActive(false); setShowQuizResult(true); playSoundEffect('lose'); }
                return () => clearInterval(interval);
            }, [quizActive, quizTimer]);

            const handleQuizAnswer = (idx) => {
                if (idx === quizQuestions[quizIndex].answer) { setQuizScore(s => s + 10); playSoundEffect('quiz_correct'); }
                else { playSoundEffect('quiz_wrong'); }
                if (quizIndex + 1 < 10) setQuizIndex(i => i + 1);
                else { setQuizActive(false); setShowQuizResult(true); playSoundEffect('win'); }
            };

            // --- FORCA ---
            const startHangman = () => {
                Tone.start();
                const cats = Object.keys(HANGMAN_CATEGORIES);
                const cat = cats[Math.floor(Math.random() * cats.length)];
                const word = HANGMAN_CATEGORIES[cat][Math.floor(Math.random() * HANGMAN_CATEGORIES[cat].length)];
                setHangmanCategory(cat); setHangmanWord(word); setHangmanWrong([]); setHangmanGuessed([]); setHangmanTimer(120); setHangmanStatus('playing'); setHintUsed(false); setGameMode('hangman');
            };

            useEffect(() => {
                let interval;
                if (gameMode === 'hangman' && hangmanStatus === 'playing' && hangmanTimer > 0) { interval = setInterval(() => setHangmanTimer(p => p - 1), 1000); }
                else if (hangmanTimer === 0 && hangmanStatus === 'playing') { 
                    setHangmanStatus('lost'); 
                    setHangmanStreak(0);
                    playSoundEffect('lose'); 
                }
                return () => clearInterval(interval);
            }, [gameMode, hangmanStatus, hangmanTimer]);

            const handleHangmanGuess = (letter) => {
                if (hangmanStatus !== 'playing' || hangmanGuessed.includes(letter) || hangmanWrong.includes(letter)) return;
                if (hangmanWord.includes(letter)) {
                    const next = [...hangmanGuessed, letter]; setHangmanGuessed(next);
                    if (hangmanWord.split('').every(l => next.includes(l))) { 
                        setHangmanStatus('won'); 
                        setHangmanStreak(s => s + 1);
                        playSoundEffect('win'); 
                    }
                    else playSoundEffect('hangman_correct');
                } else {
                    const nextWrong = [...hangmanWrong, letter]; setHangmanWrong(nextWrong);
                    if (nextWrong.length >= 6) { 
                        setHangmanStatus('lost'); 
                        setHangmanStreak(0);
                        playSoundEffect('lose'); 
                    }
                    else playSoundEffect('hangman_wrong');
                }
            };

            const useHint = () => {
                if (hintUsed || hangmanStatus !== 'playing' || hangmanWrong.length >= 5) return;
                const unrevealed = hangmanWord.split('').filter(l => !hangmanGuessed.includes(l));
                if (unrevealed.length > 0) {
                    const randomLetter = unrevealed[Math.floor(Math.random() * unrevealed.length)];
                    setHangmanGuessed(prev => [...prev, randomLetter]);
                    setHangmanWrong(prev => [...prev, 'HINT_' + Date.now()]);
                    setHintUsed(true);
                    playSoundEffect('hangman_correct');
                }
            };

            // --- MEM√ìRIA ---
            const startMemory = () => {
                Tone.start();
                const emojis = ['üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº'];
                const shuffled = [...emojis, ...emojis].sort(() => Math.random() - 0.5).map((e, i) => ({ id: i, emoji: e }));
                setMemoryCards(shuffled); setMemoryMatched([]); setMemoryFlipped([]); setMemoryWin(false); setGameMode('memory');
            };

            const handleMemoryClick = (card) => {
                if (memoryFlipped.length === 2 || memoryMatched.includes(card.id) || memoryFlipped.find(c => c.id === card.id)) return;
                const newFlipped = [...memoryFlipped, card];
                setMemoryFlipped(newFlipped);
                if (newFlipped.length === 2) {
                    if (newFlipped[0].emoji === newFlipped[1].emoji) {
                        setMemoryMatched([...memoryMatched, newFlipped[0].id, newFlipped[1].id]);
                        setMemoryFlipped([]);
                        if (memoryMatched.length + 2 === 16) { setMemoryWin(true); playSoundEffect('win'); }
                        else playSoundEffect('correct');
                    } else {
                        playSoundEffect('wrong');
                        setTimeout(() => setMemoryFlipped([]), 1000);
                    }
                }
            };

            // --- QR CODE ---
            const gerarQR = (text) => {
                if(!qrCodeRef.current) return;
                qrCodeRef.current.innerHTML = '';
                new QRCode(qrCodeRef.current, { text, width: 200, height: 200, colorDark: "#000000", colorLight: "#ffffff", correctLevel: QRCode.CorrectLevel.H });
            };

            const handleGerarPix = () => {
                if (!qrPixKey || !qrPixName || !qrPixCity) return alert("Preencha a chave, nome e cidade.");
                const info = [formatarEMV('00', 'br.gov.bcb.pix'), formatarEMV('01', qrPixKey)].join('');
                let brCode = [formatarEMV('00', '01'), formatarEMV('26', info), formatarEMV('52', '0000'), formatarEMV('53', '986')];
                if(qrPixAmount) brCode.push(formatarEMV('54', parseFloat(qrPixAmount).toFixed(2)));
                brCode.push(formatarEMV('58', 'BR'), formatarEMV('59', simplificarTexto(qrPixName).substring(0,25)), formatarEMV('60', simplificarTexto(qrPixCity).substring(0,15)), formatarEMV('62', formatarEMV('05', '***')), '6304');
                const stringPIX = brCode.join('');
                gerarQR(stringPIX + crc16(stringPIX));
            };

            // --- DI√ÅRIO MELHORADO ---
            const exportDiary = () => {
                let content = "DI√ÅRIO DE ORA√á√ÉO - SISTEMA VIDA\n\n";
                Object.keys(diaryEntries).sort().forEach(date => {
                    content += `DATA: ${date}\n-------------------\n${diaryEntries[date]}\n\n`;
                });
                const blob = new Blob([content], { type: "text/plain" });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `meu_diario_vida_${formatDateKey(new Date())}.txt`;
                link.click();
            };

            const diarySearchResults = useMemo(() => {
                if (!diarySearchTerm.trim()) return [];
                return Object.keys(diaryEntries)
                    .filter(date => diaryEntries[date].toLowerCase().includes(diarySearchTerm.toLowerCase()))
                    .map(date => ({ date, text: diaryEntries[date] }))
                    .sort((a,b) => b.date.localeCompare(a.date));
            }, [diarySearchTerm, diaryEntries]);

            // --- NARRADOR ---
            const toggleNarrator = () => {
                if (isSpeaking) { window.speechSynthesis.cancel(); setIsSpeaking(false); }
                else {
                    if (!chapterContent) return;
                    setIsSpeaking(true);
                    const text = chapterContent.map(v => v.text).join(' ');
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.onend = () => setIsSpeaking(false);
                    window.speechSynthesis.speak(utterance);
                }
            };

            const copySermon = () => {
                if (!sermon) return;
                const text = `ESBO√áO: ${sermon.theme}\nREFER√äNCIA: ${sermon.ref}\n\nINTRODU√á√ÉO: ${sermon.intro}\n\nT√ìPICOS:\n${sermon.points.map(p => `- ${p}`).join('\n')}\n\nCONCLUS√ÉO: ${sermon.conclusion}`;
                const textArea = document.createElement("textarea");
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                setShowToast(true); setTimeout(()=>setShowToast(false), 2000);
            };

            const BackButton = () => (
                <button onClick={() => {setActiveTab('home'); setGameMode('menu');}} className="mb-4 flex items-center gap-2 text-red-800 font-bold hover:underline">
                    <IconWrapper name="arrow-left" size={20} /> Voltar ao In√≠cio
                </button>
            );

            const formatTime = (s) => `${Math.floor(s/60)}:${(s%60).toString().padStart(2,'0')}`;
            const formatDateKey = (date) => date.toISOString().split('T')[0];

            // Renderiza√ß√£o do Est√∫dio Separada
            if (activeTab === 'studio') {
                return <CardStudio onExit={() => setActiveTab('home')} />;
            }

            return (
                <div className="min-h-screen flex flex-col font-inter">
                    {showToast && (
                        <div className="fixed top-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-2xl z-[100] animate-fadeIn flex items-center gap-2">
                            <IconWrapper name="check-circle" size={20} /> <span>Guardado com sucesso!</span>
                        </div>
                    )}

                    <header className="bg-red-800 text-white shadow-lg sticky top-0 z-50 no-print">
                        <div className="container mx-auto px-4 py-4 flex justify-between items-center">
                            <div className="flex items-center gap-3 cursor-pointer" onClick={() => setActiveTab('home')}>
                                <IconWrapper name="book-open" className="text-yellow-400" size={32} />
                                <div><h1 className="text-xl font-bold">Sistema Vida</h1><p className="text-xs opacity-75">Alimento Di√°rio</p></div>
                            </div>
                            <nav className="hidden xl:flex gap-4 text-sm font-medium">
                                {NAV_ITEMS.map(item => (
                                    <button key={item.id} onClick={() => setActiveTab(item.id)} className={`hover:text-yellow-300 transition-all ${activeTab === item.id ? 'text-yellow-400 font-bold underline' : ''}`}>{item.label}</button>
                                ))}
                            </nav>
                            <button className="xl:hidden" onClick={() => setMobileMenuOpen(!mobileMenuOpen)}><IconWrapper name="menu" /></button>
                        </div>
                        {mobileMenuOpen && (
                            <div className="xl:hidden bg-red-900 p-4 grid grid-cols-2 gap-2 border-t border-red-700 animate-fadeIn">
                                {NAV_ITEMS.map(item => (
                                    <button key={item.id} onClick={() => {setActiveTab(item.id); setMobileMenuOpen(false)}} className="text-left p-2 flex items-center gap-2 text-sm">
                                        <IconWrapper name={item.icon} size={16} /> {item.label}
                                    </button>
                                ))}
                            </div>
                        )}
                    </header>

                    <main className="flex-grow container mx-auto px-4 py-8">
                        {activeTab === 'home' && (
                            <div className="space-y-8 animate-fadeIn">
                                <div className="bg-gradient-to-r from-red-800 to-red-600 rounded-2xl shadow-xl p-8 text-white text-center">
                                    <h2 className="text-2xl font-serif mb-4 animate-bounce-subtle">"O Senhor √© o meu pastor, nada me faltar√°."</h2>
                                    <button onClick={() => setActiveTab('bible')} className="bg-white text-red-800 px-8 py-2 rounded-full font-bold shadow hover:bg-gray-100 transition-all">Abrir a B√≠blia</button>
                                </div>
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                    <div onClick={()=>setActiveTab('studio')} className="bg-gradient-to-br from-indigo-500 to-purple-600 text-white p-6 rounded-xl shadow-lg text-center cursor-pointer hover:scale-105 transition-transform border border-transparent">
                                        <div className="w-12 h-12 mx-auto rounded-full flex items-center justify-center bg-white/20 mb-3"><i className="fas fa-magic text-2xl"></i></div>
                                        <h3 className="font-bold">Criador de Cards</h3>
                                        <p className="text-[10px] opacity-80 uppercase mt-1">Clean Edition</p>
                                    </div>

                                    {NAV_ITEMS.filter(i => i.id !== 'home' && i.id !== 'studio').map(i => (
                                        <div key={i.id} onClick={()=>setActiveTab(i.id)} className="bg-white p-6 rounded-xl shadow text-center cursor-pointer hover:scale-105 transition-transform border border-gray-100">
                                            <div className="w-12 h-12 mx-auto rounded-full flex items-center justify-center bg-red-100 text-red-800 mb-3"><IconWrapper name={i.icon} /></div>
                                            <h3 className="font-bold text-gray-700">{i.label}</h3>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'bible' && (
                            <div className="bg-white rounded-xl shadow-lg flex flex-col md:flex-row h-[75vh] overflow-hidden animate-fadeIn">
                                <div className="w-full md:w-64 bg-gray-50 border-r p-4 overflow-y-auto">
                                    <BackButton />
                                    <select value={selectedBook} onChange={e=>setSelectedBook(e.target.value)} className="w-full p-2 mb-4 border rounded shadow-sm font-bold text-red-900">{bibleBooks.map(b=><option key={b}>{b}</option>)}</select>
                                    <div className="grid grid-cols-5 gap-1">
                                        {[...Array(50)].map((_,i)=><button key={i} onClick={()=>setSelectedChapter(i+1)} className={`p-2 text-xs rounded transition-colors ${selectedChapter===i+1?'bg-red-800 text-white':'bg-gray-200'}`}>{i+1}</button>)}
                                    </div>
                                </div>
                                <div className="flex-1 p-8 overflow-y-auto font-serif text-lg leading-relaxed relative">
                                    <div className="flex justify-between items-center mb-6 pb-2 border-b">
                                        <h2 className="text-2xl font-bold text-red-900">{selectedBook} {selectedChapter}</h2>
                                        <button onClick={toggleNarrator} title="Ouvir cap√≠tulo" className={`p-2 rounded shadow-sm border ${isSpeaking?'bg-red-100 text-red-600 border-red-200':'bg-white text-gray-400 hover:text-red-800'}`}><IconWrapper name={isSpeaking?'square':'volume-2'} size={20}/></button>
                                    </div>
                                    {loadingBible ? <p className="text-center text-gray-400 animate-pulse">Consultando as escrituras...</p> : chapterContent?.map(v=>(
                                        <p key={v.verse} onClick={()=> {
                                            const key = `${selectedBook}-${selectedChapter}-${v.verse}`;
                                            setHighlights(p => ({...p, [key]: p[key] ? null : '#fef08a'}));
                                        }} className="mb-2 cursor-pointer p-1 rounded transition-colors hover:bg-gray-50" style={{ backgroundColor: highlights[`${selectedBook}-${selectedChapter}-${v.verse}`] }}>
                                            <span className="text-red-700 font-bold text-xs mr-2 select-none">{v.verse}</span>{v.text}
                                        </p>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'names' && (
                            <div className="max-w-2xl mx-auto space-y-6 animate-fadeIn">
                                <BackButton />
                                <div className="bg-white p-8 rounded-xl shadow-lg text-center">
                                    <h2 className="text-2xl font-bold mb-4 text-red-800">Significado dos Nomes</h2>
                                    <div className="flex gap-2">
                                        <input type="text" value={inputName} onChange={(e)=>setInputName(e.target.value)} className="flex-1 p-3 border rounded shadow-inner" placeholder="Ex: Lucas, Maria..." />
                                        <button onClick={()=>{
                                            const res = nameDatabase[inputName.toLowerCase().trim()];
                                            setNameResult(res ? {name: inputName, meaning: res} : {name: inputName, meaning: "O Senhor conhece o seu nome e tem um prop√≥sito glorioso para a sua vida!"});
                                        }} className="bg-red-800 text-white px-6 rounded font-bold hover:bg-red-900 transition-colors">Ver</button>
                                    </div>
                                </div>
                                {nameResult && <div className="bg-white p-6 rounded-xl border-l-4 border-yellow-500 shadow animate-fadeIn"><h3 className="font-bold text-lg mb-2">{nameResult.name}</h3><p className="italic text-gray-700">{nameResult.meaning}</p></div>}
                            </div>
                        )}

                        {activeTab === 'preaching' && (
                            <div className="max-w-3xl mx-auto space-y-6 animate-fadeIn">
                                <BackButton />
                                <div className="bg-white p-8 rounded-2xl shadow-lg text-center border-t-4 border-red-800">
                                    <h2 className="text-2xl font-bold mb-4 text-red-800 flex items-center justify-center gap-2">
                                        <IconWrapper name="megaphone" className="text-yellow-500" size={32}/> 
                                        Sugest√µes para Prega√ß√£o
                                    </h2>
                                    <button onClick={()=>setSermon(preachingDatabase[Math.floor(Math.random()*preachingDatabase.length)])} className="bg-red-800 text-white px-10 py-3 rounded-full font-bold shadow-xl hover:bg-red-900 flex items-center justify-center gap-3 mx-auto transition-transform active:scale-95">
                                        <IconWrapper name="refresh-cw" size={20}/> Gerar Novo Esbo√ßo
                                    </button>
                                </div>

                                {sermon && (
                                    <div className="bg-white p-8 rounded-3xl shadow-xl border border-gray-100 animate-fadeIn relative overflow-hidden">
                                        <div className="absolute top-0 right-0 p-4">
                                            <button onClick={copySermon} className="p-3 bg-gray-50 hover:bg-yellow-50 text-gray-400 hover:text-yellow-600 rounded-full transition-colors shadow-sm border border-gray-100" title="Copiar Esbo√ßo">
                                                <IconWrapper name="copy" size={24}/>
                                            </button>
                                        </div>
                                        <div className="mb-8 border-b border-gray-100 pb-4 text-center">
                                            <h3 className="text-2xl font-bold text-red-900 mb-1">{sermon.theme}</h3>
                                            <p className="text-sm font-bold text-yellow-600 tracking-widest uppercase">{sermon.ref}</p>
                                        </div>
                                        <div className="space-y-8">
                                            <section>
                                                <h4 className="text-xs font-bold text-gray-400 uppercase tracking-widest mb-2 flex items-center gap-2">Introdu√ß√£o</h4>
                                                <p className="text-gray-700 italic leading-relaxed">{sermon.intro}</p>
                                            </section>
                                            <section>
                                                <h4 className="text-xs font-bold text-gray-400 uppercase tracking-widest mb-4 flex items-center gap-2">T√≥picos Principais</h4>
                                                <ul className="space-y-4">
                                                    {sermon.points.map((point, idx) => (
                                                        <li key={idx} className="flex gap-4 items-start p-4 bg-gray-50 rounded-2xl border border-white">
                                                            <span className="flex-shrink-0 w-8 h-8 rounded-full bg-red-800 text-white flex items-center justify-center font-bold text-sm">{idx + 1}</span>
                                                            <p className="text-gray-800 font-medium pt-1">{point}</p>
                                                        </li>
                                                    ))}
                                                </ul>
                                            </section>
                                            <section className="bg-red-50 p-6 rounded-2xl border border-red-100">
                                                <h4 className="text-xs font-bold text-red-800 uppercase tracking-widest mb-2">Conclus√£o</h4>
                                                <p className="text-red-900 font-bold leading-relaxed">{sermon.conclusion}</p>
                                            </section>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'games' && (
                            <div className="max-w-4xl mx-auto bg-white p-8 rounded-2xl shadow animate-fadeIn text-center min-h-[500px]">
                                <BackButton />
                                {gameMode === 'menu' && (
                                    <div className="grid md:grid-cols-3 gap-6 mt-8">
                                        <div onClick={startQuiz} className="p-8 border-2 border-yellow-200 rounded-xl cursor-pointer hover:bg-yellow-50 transition-all group">
                                            <div className="text-4xl mb-4 group-hover:scale-110 transition-all">üìñ</div>
                                            <h3 className="font-bold text-gray-800">Quiz B√≠blico</h3>
                                            <p className="text-xs text-gray-400 mt-2">10 quest√µes desafiadoras.</p>
                                        </div>
                                        <div onClick={startMemory} className="p-8 border-2 border-blue-200 rounded-xl cursor-pointer hover:bg-blue-50 transition-all group">
                                            <div className="text-4xl mb-4 group-hover:scale-110 transition-all">üê∂</div>
                                            <h3 className="font-bold text-gray-800">Mem√≥ria</h3>
                                            <p className="text-xs text-gray-400 mt-2">Encontre os pares de animais.</p>
                                        </div>
                                        <div onClick={startHangman} className="p-8 border-2 border-green-200 rounded-xl cursor-pointer hover:bg-green-50 transition-all group">
                                            <div className="text-4xl mb-4 group-hover:scale-110 transition-all">‚öì</div>
                                            <h3 className="font-bold text-gray-800">Forca</h3>
                                            <p className="text-xs text-gray-400 mt-2">Adivinhe palavras b√≠blicas.</p>
                                        </div>
                                    </div>
                                )}

                                {gameMode === 'quiz' && (
                                    <div className="animate-fadeIn">
                                        {!showQuizResult ? (
                                            <div>
                                                <div className="flex justify-between items-center mb-8 bg-gray-50 p-4 rounded-xl">
                                                    <span className="text-red-600 font-bold">Tempo: {formatTime(quizTimer)}</span>
                                                    <span className="text-gray-500 font-bold">Quest√£o {quizIndex + 1}/10</span>
                                                    <span className="text-yellow-600 font-bold">Pontos: {quizScore}</span>
                                                </div>
                                                <h3 className="text-2xl font-bold mb-8 px-4 font-serif">{quizQuestions[quizIndex]?.question}</h3>
                                                <div className="grid gap-3 max-w-md mx-auto">
                                                    {quizQuestions[quizIndex]?.options.map((opt, i) => (
                                                        <button key={i} onClick={()=>handleQuizAnswer(i)} className="p-4 border-2 rounded-xl hover:bg-red-50 text-left font-medium transition-all hover:border-red-300 active:scale-95">{opt}</button>
                                                    ))}
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="py-12">
                                                <h2 className="text-4xl font-bold text-red-800 mb-4">Parab√©ns!</h2>
                                                <div className="text-6xl font-arcade text-yellow-600 mb-8">{quizScore} pts</div>
                                                <button onClick={startQuiz} className="bg-red-800 text-white px-10 py-3 rounded-full font-bold shadow-lg">Jogar Novamente</button>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {gameMode === 'hangman' && (
                                    <div className="animate-fadeIn relative">
                                        <div className="flex flex-col md:flex-row justify-between items-center mb-6 gap-4 font-bold bg-gray-50 p-4 rounded-2xl">
                                            <div className="flex flex-col items-start">
                                                <span className="text-blue-600 uppercase tracking-widest text-xs">CATEGORIA: {hangmanCategory}</span>
                                                <div className="flex items-center gap-2 mt-1">
                                                    <IconWrapper name="zap" className="text-yellow-500" size={16}/>
                                                    <span className="text-sm font-arcade text-gray-700">STREAK: {hangmanStreak}</span>
                                                </div>
                                            </div>
                                            <span className={`text-2xl font-arcade ${hangmanTimer <= 10 ? 'text-red-600 animate-pulse' : 'text-gray-600'}`}>{formatTime(hangmanTimer)}</span>
                                            <button 
                                                onClick={useHint} 
                                                disabled={hintUsed || hangmanStatus !== 'playing' || hangmanWrong.length >= 5}
                                                className={`flex items-center gap-2 px-4 py-2 rounded-xl text-xs font-bold transition-all ${hintUsed ? 'bg-gray-200 text-gray-400' : 'bg-yellow-100 text-yellow-700 hover:bg-yellow-200 shadow-sm'}`}
                                            >
                                                <IconWrapper name="help-circle" size={16}/> PISTA
                                            </button>
                                        </div>
                                        
                                        <div className="flex flex-col md:flex-row items-center gap-12 mt-10">
                                            <div className="flex-1 bg-white p-6 rounded-[2.5rem] shadow-inner border border-gray-100">
                                                <svg className="w-56 h-56 mx-auto" viewBox="0 0 100 120">
                                                    <line x1="10" y1="115" x2="90" y2="115" stroke="#4B5563" strokeWidth="6" strokeLinecap="round" />
                                                    <line x1="30" y1="115" x2="30" y2="10" stroke="#4B5563" strokeWidth="6" strokeLinecap="round" />
                                                    <line x1="30" y1="10" x2="75" y2="10" stroke="#4B5563" strokeWidth="6" strokeLinecap="round" />
                                                    <line x1="75" y1="10" x2="75" y2="25" stroke="#4B5563" strokeWidth="2" />
                                                    <circle cx="75" cy="35" r="10" className={`hangman-part ${hangmanWrong.length >= 1 ? 'opacity-100' : 'opacity-0'} ${hangmanStatus === 'lost' ? 'hangman-part-error' : ''}`} fill="none" stroke="#111827" />
                                                    <line x1="75" y1="45" x2="75" y2="75" className={`hangman-part ${hangmanWrong.length >= 2 ? 'opacity-100' : 'opacity-0'} ${hangmanStatus === 'lost' ? 'hangman-part-error' : ''}`} stroke="#111827" />
                                                    <line x1="75" y1="55" x2="60" y2="45" className={`hangman-part ${hangmanWrong.length >= 3 ? 'opacity-100' : 'opacity-0'} ${hangmanStatus === 'lost' ? 'hangman-part-error' : ''}`} stroke="#111827" />
                                                    <line x1="75" y1="55" x2="90" y2="45" className={`hangman-part ${hangmanWrong.length >= 4 ? 'opacity-100' : 'opacity-0'} ${hangmanStatus === 'lost' ? 'hangman-part-error' : ''}`} stroke="#111827" />
                                                    <line x1="75" y1="75" x2="60" y2="95" className={`hangman-part ${hangmanWrong.length >= 5 ? 'opacity-100' : 'opacity-0'} ${hangmanStatus === 'lost' ? 'hangman-part-error' : ''}`} stroke="#111827" />
                                                    <line x1="75" y1="75" x2="90" y2="95" className={`hangman-part ${hangmanWrong.length >= 6 ? 'opacity-100' : 'opacity-0'} ${hangmanStatus === 'lost' ? 'hangman-part-error' : ''}`} stroke="#111827" />
                                                </svg>
                                            </div>
                                            <div className="flex-1 space-y-12">
                                                <div className="flex flex-wrap justify-center gap-3">
                                                    {hangmanWord.split('').map((l, idx) => (
                                                        <div key={idx} className={`w-10 h-12 md:w-12 md:h-14 flex items-center justify-center text-3xl font-arcade border-b-4 transition-all duration-500 rounded-t-lg ${hangmanGuessed.includes(l) ? 'border-green-500 text-green-600 bg-green-50' : 'border-gray-200 text-transparent bg-gray-50'}`}>
                                                            {l}
                                                        </div>
                                                    ))}
                                                </div>
                                                {hangmanStatus === 'playing' ? (
                                                    <div className="grid grid-cols-7 md:grid-cols-9 gap-2 max-w-sm mx-auto p-4 bg-gray-50 rounded-3xl border border-gray-100">
                                                        {'ABCDEFGHIJKLMNOPQRSTUVWXYZ√á'.split('').map(l => (
                                                            <button key={l} onClick={()=>handleHangmanGuess(l)} disabled={hangmanGuessed.includes(l) || hangmanWrong.includes(l)} className={`w-9 h-9 md:w-10 md:h-10 border rounded-xl font-bold text-sm shadow-sm transition-all active:scale-90 ${hangmanGuessed.includes(l) ? 'bg-green-500 text-white' : hangmanWrong.includes(l) ? 'bg-red-100 text-red-300 opacity-50' : 'bg-white hover:bg-blue-50'}`}>{l}</button>
                                                        ))}
                                                    </div>
                                                ) : (
                                                    <div className={`p-8 rounded-[2rem] font-bold shadow-2xl ${hangmanStatus === 'won' ? 'bg-green-600 text-white' : 'bg-red-600 text-white'}`}>
                                                        <p className="text-3xl mb-3">{hangmanStatus === 'won' ? 'BRILHANTE!' : 'PERDEU!'}</p>
                                                        <p className="text-sm opacity-80 mb-6 underline font-arcade">{hangmanWord}</p>
                                                        <button onClick={startHangman} className="bg-white text-gray-900 px-8 py-3 rounded-full font-bold shadow-lg hover:scale-105 flex items-center gap-2 mx-auto"><IconWrapper name="refresh-cw" size={18}/> Novo Jogo</button>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {gameMode === 'memory' && (
                                    <div className="animate-fadeIn">
                                        {!memoryWin ? (
                                            <div className="grid grid-cols-4 gap-4 max-w-sm mx-auto mt-6">
                                                {memoryCards.map(card => (
                                                    <div key={card.id} className={`memory-card h-24 w-full ${memoryFlipped.find(c=>c.id===card.id) || memoryMatched.includes(card.id) ? 'is-flipped' : ''}`} onClick={()=>handleMemoryClick(card)}>
                                                        <div className="memory-card-inner"><div className="memory-card-back font-bold">?</div><div className="memory-card-front text-4xl">{card.emoji}</div></div>
                                                    </div>
                                                ))}
                                            </div>
                                        ) : (
                                            <div className="py-12 text-blue-600 font-bold text-3xl">Venceu! üéâ<br/><button onClick={startMemory} className="mt-6 bg-blue-600 text-white px-10 py-3 rounded-full text-sm shadow-xl">Recome√ßar</button></div>
                                        )}
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'qrcode' && (
                            <div className="max-w-4xl mx-auto space-y-6 animate-fadeIn">
                                <BackButton />
                                <div className="grid md:grid-cols-2 gap-6">
                                    <div className="bg-white p-6 rounded-2xl shadow border-t-4 border-red-800 space-y-4">
                                        <h3 className="font-bold flex items-center gap-2 text-red-800"><IconWrapper name="book-open" size={18}/> Endere√ßo Web</h3>
                                        <input type="text" value={qrUrl} onChange={e=>setQrUrl(e.target.value)} placeholder="https://..." className="w-full p-3 border rounded shadow-inner" />
                                        <button onClick={()=>gerarQR(qrUrl)} className="w-full bg-red-800 text-white py-3 rounded-xl font-bold hover:bg-red-900 shadow-md">Criar C√≥digo</button>
                                    </div>
                                    <div className="bg-white p-6 rounded-2xl shadow border-t-4 border-blue-600 space-y-4">
                                        <h3 className="font-bold flex items-center gap-2 text-blue-800"><IconWrapper name="radio" size={18}/> Wi-Fi Direto</h3>
                                        <div className="grid grid-cols-2 gap-2"><input type="text" value={qrWifiSsid} onChange={e=>setQrWifiSsid(e.target.value)} placeholder="Rede" className="p-2 border rounded" /><input type="password" value={qrWifiPass} onChange={e=>setQrWifiPass(e.target.value)} placeholder="Senha" className="p-2 border rounded" /></div>
                                        <button onClick={()=>gerarQR(`WIFI:T:WPA;S:${qrWifiSsid};P:${qrWifiPass};;`)} className="w-full bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700 shadow-md">Gerar Wi-Fi</button>
                                    </div>
                                    <div className="bg-white p-6 rounded-2xl shadow border-t-4 border-green-600 space-y-4 md:col-span-2">
                                        <h3 className="font-bold flex items-center gap-2 text-green-800"><IconWrapper name="qr-code" size={18}/> Pagamento PIX (Brasil)</h3>
                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-2">
                                            <input type="text" value={qrPixKey} onChange={e=>setQrPixKey(e.target.value)} placeholder="Chave" className="p-2 border rounded text-xs" /><input type="text" value={qrPixName} onChange={e=>setQrPixName(e.target.value)} placeholder="Nome" className="p-2 border rounded text-xs" /><input type="text" value={qrPixCity} onChange={e=>setQrPixCity(e.target.value)} placeholder="Cidade" className="p-2 border rounded text-xs" /><input type="number" value={qrPixAmount} onChange={e=>setQrPixAmount(e.target.value)} placeholder="Valor" className="p-2 border rounded text-xs" />
                                        </div>
                                        <button onClick={handleGerarPix} className="w-full bg-green-700 text-white py-3 rounded-xl font-bold hover:bg-green-800 shadow-md">Criar C√≥digo PIX</button>
                                    </div>
                                </div>
                                <div className="bg-white p-12 rounded-3xl shadow-xl flex flex-col items-center border border-gray-50"><div ref={qrCodeRef} className="border-8 border-gray-50 p-4 bg-white shadow-inner rounded-xl"></div><p className="mt-6 text-[10px] text-gray-400 uppercase font-bold tracking-[0.2em]">Digitalize para usar</p></div>
                            </div>
                        )}

                        {activeTab === 'radio' && (
                            <div className="max-w-xl mx-auto bg-gray-900 text-white p-12 rounded-[3rem] shadow-2xl text-center animate-fadeIn border border-gray-800">
                                <BackButton /><div className="mb-12"><IconWrapper name="radio" size={100} className="text-yellow-400 mx-auto animate-pulse" /></div>
                                <h2 className="text-3xl font-bold mb-3">R√°dio Gospel</h2><p className="text-gray-400 text-sm mb-12 uppercase tracking-widest font-inter">Louvores e Adora√ß√£o 24h</p>
                                <div className="flex justify-center items-end gap-1 mb-12 h-16">{isPlayingRadio ? [...Array(6)].map((_,i)=><div key={i} className="sound-bar" style={{animationDuration: `${0.4 + Math.random()}s`, width: '8px'}}></div>) : <div className="h-1 w-40 bg-gray-800 rounded-full"></div>}</div>
                                <button onClick={()=>{if(isPlayingRadio) audioRef.current.pause(); else audioRef.current.play(); setIsPlayingRadio(!isPlayingRadio);}} className={`w-24 h-24 rounded-full flex items-center justify-center mx-auto shadow-xl transition-all transform hover:scale-110 active:scale-95 ${isPlayingRadio?'bg-yellow-400 text-gray-900':'bg-red-600 text-white'}`}><IconWrapper name={isPlayingRadio ? 'square' : 'radio'} size={45} /></button>
                                <audio ref={audioRef} src="https://live.hunter.fm/gospel_stream?ag=mp3" crossOrigin="anonymous"></audio>
                            </div>
                        )}

                        {activeTab === 'notes' && (
                            <div className="max-w-5xl mx-auto space-y-8 animate-fadeIn">
                                <BackButton />
                                
                                <div className="grid md:grid-cols-12 gap-8">
                                    <div className="md:col-span-4 space-y-6">
                                        <div className="bg-white p-6 rounded-3xl shadow-lg border border-gray-100">
                                            <h4 className="text-xs font-bold text-gray-400 uppercase tracking-widest mb-4 flex items-center gap-2"><IconWrapper name="search" size={14}/> Pesquisar Notas</h4>
                                            <input 
                                                type="text" 
                                                value={diarySearchTerm} 
                                                onChange={(e)=>setDiarySearchTerm(e.target.value)} 
                                                placeholder="Palavra-chave..." 
                                                className="w-full p-3 bg-gray-50 border-none rounded-2xl focus:ring-2 focus:ring-red-100 outline-none text-sm"
                                            />
                                        </div>

                                        {diarySearchTerm && (
                                            <div className="bg-white p-6 rounded-3xl shadow-lg border border-gray-100 max-h-[400px] overflow-y-auto space-y-4">
                                                <h4 className="text-xs font-bold text-red-800 uppercase tracking-widest mb-2">Resultados ({diarySearchResults.length})</h4>
                                                {diarySearchResults.map(res => (
                                                    <div key={res.date} onClick={()=>{setCurrentDate(new Date(res.date)); setDiarySearchTerm('');}} className="p-3 bg-red-50 rounded-xl cursor-pointer hover:bg-red-100 transition-colors">
                                                        <p className="text-[10px] font-bold text-red-800 mb-1">{new Date(res.date).toLocaleDateString('pt-PT')}</p>
                                                        <p className="text-xs text-gray-600 line-clamp-2">{res.text}</p>
                                                    </div>
                                                ))}
                                                {diarySearchResults.length === 0 && <p className="text-xs text-gray-400 italic">Nada encontrado.</p>}
                                            </div>
                                        )}

                                        <div className="bg-gradient-to-br from-red-800 to-red-900 p-8 rounded-[2rem] text-white shadow-xl">
                                            <h3 className="text-xl font-bold mb-2">Meu Legado</h3>
                                            <p className="text-xs opacity-75 mb-6">Total de {Object.keys(diaryEntries).length} dias registados.</p>
                                            <button onClick={exportDiary} className="w-full bg-white/10 hover:bg-white/20 p-4 rounded-2xl border border-white/20 font-bold text-sm transition-all flex items-center justify-center gap-3">
                                                <IconWrapper name="download" size={18}/> Exportar Di√°rio
                                            </button>
                                        </div>
                                    </div>

                                    <div className="md:col-span-8 bg-white p-10 rounded-[3rem] shadow-2xl space-y-8 border border-gray-100 relative">
                                        <div className="flex justify-between items-center bg-gray-50 p-6 rounded-[2rem] border border-gray-100">
                                            <button onClick={()=>{const d=new Date(currentDate); d.setDate(d.getDate()-1); setCurrentDate(d);}} className="p-3 border rounded-full bg-white shadow-sm hover:bg-gray-100 transition-all active:scale-90"><IconWrapper name="chevron-left" size={24}/></button>
                                            <div className="text-center">
                                                <h3 className="font-bold text-red-900 text-xl capitalize">{currentDate.toLocaleDateString('pt-PT', { weekday: 'long', day: 'numeric', month: 'long' })}</h3>
                                                <p className="text-[10px] text-gray-400 uppercase font-bold tracking-[0.2em] mt-2">Ora√ß√£o e Reflex√£o</p>
                                            </div>
                                            <button onClick={()=>{const d=new Date(currentDate); d.setDate(d.getDate()+1); setCurrentDate(d);}} className="p-3 border rounded-full bg-white shadow-sm hover:bg-gray-100 transition-all active:scale-90"><IconWrapper name="chevron-right" size={24}/></button>
                                        </div>
                                        
                                        <div className="relative group">
                                            <textarea 
                                                value={diaryEntries[formatDateKey(currentDate)] || ""} 
                                                onChange={(e)=>setDiaryEntries({...diaryEntries, [formatDateKey(currentDate)]: e.target.value})}
                                                className="w-full h-[500px] p-10 border border-gray-100 rounded-[2.5rem] font-handwriting text-2xl focus:ring-8 focus:ring-red-50 outline-none resize-none shadow-inner leading-relaxed bg-[#fdfdfd] text-gray-700 placeholder-gray-300" 
                                                placeholder="Querido Pai Celestial, no dia de hoje eu..."
                                            ></textarea>
                                            <div className="absolute bottom-6 right-8 text-[10px] font-bold text-gray-300 uppercase tracking-widest">
                                                {(diaryEntries[formatDateKey(currentDate)] || "").length} caracteres
                                            </div>
                                        </div>

                                        <div className="flex justify-between items-center px-4">
                                            <p className="text-[10px] text-gray-400 italic">"Escreve a vis√£o e torna-a bem leg√≠vel..." Habacuque 2:2</p>
                                            <button onClick={()=>{setShowToast(true); setTimeout(()=>setShowToast(false), 2000);}} className="bg-red-800 text-white px-10 py-3 rounded-full font-bold shadow-xl hover:bg-red-900 flex items-center gap-3 transition-all hover:scale-105 active:scale-95"><IconWrapper name="refresh-cw" size={18}/> Guardar Agora</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    <footer className="bg-gray-900 text-gray-400 py-12 text-center border-t border-gray-800 mt-auto no-print">
                        <div className="container mx-auto px-4">
                            <p className="font-bold text-white mb-3 text-lg">Direitos Autorais &copy; J√¢nio Carlos P J</p>
                            <p className="text-[10px] mb-8 opacity-40 tracking-[0.3em] uppercase font-bold font-inter">Configura√ß√£o Profissional Atualizada</p>
                            <a href="https://wa.me/5575998312170" target="_blank" className="inline-flex items-center gap-4 bg-green-600 text-white px-10 py-3 rounded-full font-bold text-sm shadow-[0_10px_25px_rgba(22,163,74,0.4)] hover:bg-green-700 transition-all transform hover:-translate-y-1">
                                WhatsApp do Criador: +55 (75) 99831-2170
                            </a>
                        </div>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ErrorBoundary><App /></ErrorBoundary>);
    </script>
</body>
</html>
